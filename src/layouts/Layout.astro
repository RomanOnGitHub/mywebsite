---
import BaseHead from '@/components/layout/BaseHead.astro';
import Sidebar from '@/components/layout/Sidebar.astro';
import Analytics from '@/components/layout/Analytics.astro';
import CookieConsent from '@/components/layout/CookieConsent.astro';
import { localeToDir } from '@/utils/slugs';
import type { StructuredData } from '@/types/structured-data';

interface Props {
  title: string;
  description: string;
  slug?: string;
  lang?: string;
  structuredData?: StructuredData;
  hideSidebar?: boolean;
}

const { title, description, slug, lang = 'ru', structuredData, hideSidebar = false } = Astro.props;
const dir = localeToDir(lang);
---

<!doctype html>
<html lang={lang} dir={dir}>
  <head>
    <BaseHead title={title} description={description} lang={lang} />
    {structuredData && (
      <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
    )}
  </head>
  <body 
    class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"
    data-pagefind-body
    data-pagefind-meta={`lang:${lang}`}
  >
    <div class="flex min-h-screen">
      {!hideSidebar && <Sidebar slug={slug} lang={lang} />}
      <main 
        transition:animate="fade"
        class="flex-1 flex flex-col items-center"
        class:pr-64={!hideSidebar}
        style="min-width: 0;"
      >
        <slot />
      </main>
    </div>
    <CookieConsent lang={lang} />
    <Analytics />
  </body>
</html>

<style>
  /* View Transitions fade animation */
  @view-transition {
    navigation: auto;
  }
  
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 0.3s;
    animation-timing-function: ease-in-out;
  }
  
  ::view-transition-old(root) {
    animation-name: fade-out;
  }
  
  ::view-transition-new(root) {
    animation-name: fade-in;
  }
  
  @keyframes fade-out {
    from {
      opacity: 1;
    }
    to {
      opacity: 0;
    }
  }
  
  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
</style>
