---
import Layout from '@/layouts/Layout.astro';
import Breadcrumbs from '@/components/ui/Breadcrumbs.astro';
import { SUPPORTED_LOCALES, type Locale, getLocalizedPath } from '@/utils/slugs';

interface Props {
  lang: Locale;
}

const { lang } = Astro.params as Props;

export function getStaticPaths() {
  return SUPPORTED_LOCALES.map(lang => ({ 
    params: { lang } 
  }));
}
---

<Layout 
  title="–ì—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π" 
  description="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏"
  lang={lang}
  hideSidebar={true}
>
  <div class="max-w-7xl p-6 md:p-8 lg:p-12">
    <Breadcrumbs title="–ì—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π" lang={lang} />
    <header class="mb-8">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-4xl font-bold">–ì—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π</h1>
        <a 
          href={getLocalizedPath('', lang)}
          class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 underline transition-colors"
          data-astro-prefetch
        >
          ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
      </div>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        –ò—Å—Å–ª–µ–¥—É–π—Ç–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ —Å–∞–π—Ç–∞
      </p>
    </header>
    
    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <div class="mb-6 space-y-4">
      <!-- –ü–æ–∏—Å–∫ —É–∑–ª–æ–≤ -->
      <div class="flex items-center gap-2">
        <label for="search-nodes" class="text-sm font-medium text-gray-700 dark:text-gray-300">
          üîç –ü–æ–∏—Å–∫:
        </label>
        <input
          type="text"
          id="search-nodes"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–∑–ª–∞..."
          class="flex-1 max-w-md border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:outline-none"
        />
        <button
          id="clear-search"
          class="px-3 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors text-sm"
          style="display: none;"
        >
          ‚úï –û—á–∏—Å—Ç–∏—Ç—å
        </button>
      </div>
      
      <!-- –§–∏–ª—å—Ç—Ä—ã -->
      <div class="flex flex-wrap gap-4 items-center">
        <div class="flex items-center gap-2">
          <label for="filter-type" class="text-sm font-medium text-gray-700 dark:text-gray-300">
            –¢–∏–ø:
          </label>
          <select 
            id="filter-type"
            multiple
            size="4"
            class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
            style="min-width: 150px; max-height: 120px;"
          >
            <option value="blog">–ë–ª–æ–≥</option>
            <option value="cases">–ö–µ–π—Å—ã</option>
            <option value="services">–£—Å–ª—É–≥–∏</option>
            <option value="industries">–û—Ç—Ä–∞—Å–ª–∏</option>
          </select>
          <span class="text-xs text-gray-500 dark:text-gray-400">(Ctrl+Click)</span>
        </div>
        
        <div class="flex items-center gap-2">
          <label for="filter-tags" class="text-sm font-medium text-gray-700 dark:text-gray-300">
            –¢–µ–≥:
          </label>
          <select 
            id="filter-tags"
            multiple
            size="4"
            class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
            style="min-width: 150px; max-height: 120px;"
          >
            <option value="">–í—Å–µ —Ç–µ–≥–∏</option>
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ graph.nodes -->
          </select>
          <span class="text-xs text-gray-500 dark:text-gray-400">(Ctrl+Click)</span>
        </div>
        
        <div class="flex items-center gap-2">
          <label for="filter-link-type" class="text-sm font-medium text-gray-700 dark:text-gray-300">
            –¢–∏–ø —Å–≤—è–∑–∏:
          </label>
          <select 
            id="filter-link-type"
            multiple
            size="2"
            class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
            style="min-width: 150px;"
          >
            <option value="explicit">–Ø–≤–Ω—ã–µ —Å–≤—è–∑–∏</option>
            <option value="outbound">–ò—Å—Ö–æ–¥—è—â–∏–µ —Å—Å—ã–ª–∫–∏</option>
          </select>
        </div>
        
        <button
          id="reset-filters"
          class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md transition-colors text-sm"
        >
          –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
        </button>
      </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∞ -->
    <div 
      id="graph-container" 
      class="border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 overflow-hidden relative"
      style="width: 100%; height: 600px;"
    ></div>
    
    <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã –¥–ª—è –≥—Ä–∞—Ñ–∞ -->
    <div class="mt-4 flex flex-wrap gap-2 items-center justify-center text-sm">
      <button
        id="zoom-in"
        class="px-3 py-1.5 bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white rounded-md transition-colors"
        title="–£–≤–µ–ª–∏—á–∏—Ç—å"
      >
        üîç+
      </button>
      <button
        id="zoom-out"
        class="px-3 py-1.5 bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white rounded-md transition-colors"
        title="–£–º–µ–Ω—å—à–∏—Ç—å"
      >
        üîç-
      </button>
      <button
        id="zoom-fit"
        class="px-3 py-1.5 bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white rounded-md transition-colors"
        title="–ü–æ–¥–æ–≥–Ω–∞—Ç—å –ø–æ–¥ —Ä–∞–∑–º–µ—Ä"
      >
        ‚õ∂ –ü–æ–¥–æ–≥–Ω–∞—Ç—å
      </button>
      <button
        id="zoom-reset"
        class="px-3 py-1.5 bg-gray-600 dark:bg-gray-500 hover:bg-gray-700 dark:hover:bg-gray-600 text-white rounded-md transition-colors"
        title="–°–±—Ä–æ—Å–∏—Ç—å zoom"
      >
        ‚Ü∫ –°–±—Ä–æ—Å–∏—Ç—å
      </button>
      <button
        id="nav-back"
        class="px-3 py-1.5 bg-gray-600 dark:bg-gray-500 hover:bg-gray-700 dark:hover:bg-gray-600 text-white rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        title="–ù–∞–∑–∞–¥"
        disabled
      >
        ‚Üê –ù–∞–∑–∞–¥
      </button>
      <button
        id="nav-forward"
        class="px-3 py-1.5 bg-gray-600 dark:bg-gray-500 hover:bg-gray-700 dark:hover:bg-gray-600 text-white rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        title="–í–ø–µ—Ä—ë–¥"
        disabled
      >
        –í–ø–µ—Ä—ë–¥ ‚Üí
      </button>
      <button
        id="export-image"
        class="px-3 py-1.5 bg-green-600 dark:bg-green-500 hover:bg-green-700 dark:hover:bg-green-600 text-white rounded-md transition-colors"
        title="–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
      >
        üì• –≠–∫—Å–ø–æ—Ä—Ç
      </button>
      <button
        id="export-json"
        class="px-3 py-1.5 bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white rounded-md transition-colors"
        title="–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∞ –≤ JSON"
      >
        üìÑ JSON
      </button>
      <div class="text-gray-600 dark:text-gray-400 ml-4">
        <span class="text-xs">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–ª–µ—Å–æ –º—ã—à–∏ –¥–ª—è zoom, –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è</span>
      </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é (—Å–∫—Ä—ã—Ç–æ–µ) -->
    <div
      id="context-menu"
      class="hidden fixed bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg py-1 z-50"
      style="min-width: 150px;"
    >
      <button
        id="context-copy-node"
        class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm"
      >
        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —É–∑–ª–∞
      </button>
      <button
        id="context-open-new"
        class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm"
      >
        üîó –û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
      </button>
      <button
        id="context-highlight-connections"
        class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm"
      >
        ‚ú® –í—ã–¥–µ–ª–∏—Ç—å —Å–≤—è–∑–∏
      </button>
      <button
        id="context-select-incoming"
        class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm"
      >
        ‚Üê –í—ã–¥–µ–ª–∏—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–≤—è–∑–∏
      </button>
      <button
        id="context-select-outgoing"
        class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm"
      >
        ‚Üí –í—ã–¥–µ–ª–∏—Ç—å –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–≤—è–∑–∏
      </button>
      <button
        id="context-select-all-edges"
        class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm"
      >
        ‚Üî –í—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ —Å–≤—è–∑–∏
      </button>
    </div>
    
    <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
    <div class="mt-6 flex flex-wrap gap-4 text-sm">
      <div class="flex items-center gap-2">
        <div class="w-4 h-4 rounded-full bg-blue-500"></div>
        <span>–ë–ª–æ–≥</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-4 h-4 rounded-full bg-green-500"></div>
        <span>–ö–µ–π—Å—ã</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-4 h-4 rounded-full bg-yellow-500"></div>
        <span>–£—Å–ª—É–≥–∏</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-4 h-4 rounded-full bg-purple-500"></div>
        <span>–û—Ç—Ä–∞—Å–ª–∏</span>
      </div>
    </div>
  </div>
</Layout>

<script>
  import { initGraphPage } from '@/utils/graph-page';
  
  const destroy = initGraphPage();
  
  const cleanup = () => {
    destroy();
    document.removeEventListener('astro:after-swap', cleanup);
  };

  document.addEventListener('astro:after-swap', cleanup);
</script>
