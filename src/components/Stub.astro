---
import { WEB3FORMS_KEY } from 'astro:env/server';

interface Props {
  slug: string;
  lang: string;
  collection: string;
}

const { slug, lang, collection } = Astro.props;
---

<meta name="robots" content="noindex, nofollow" />

<article class="max-w-2xl mx-auto py-16 px-4">
  <h1 class="text-3xl font-bold mb-4">Контент готовится</h1>
  <p class="text-lg text-gray-600 dark:text-gray-400 mb-8">
    Эта страница ещё не переведена на выбранный язык ({lang}).
  </p>
  
  <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6 mb-8">
    <h2 class="text-xl font-semibold mb-2">Запросить перевод</h2>
    <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
      Оставьте свой email, и мы уведомим вас, когда контент будет переведён.
    </p>
    
    <form 
      action="https://api.web3forms.com/submit" 
      method="POST" 
      class="space-y-4"
      id="translation-request-form"
    >
      <input type="hidden" name="access_key" value={WEB3FORMS_KEY} />
      <input type="hidden" name="subject" value={`Запрос перевода: ${collection}/${slug} → ${lang}`} />
      <input type="hidden" name="slug" value={slug} />
      <input type="hidden" name="collection" value={collection} />
      <input type="hidden" name="requested_lang" value={lang} />
      
      <div>
        <label 
          for="email" 
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Email для уведомления:
        </label>
        <input 
          type="email" 
          name="email" 
          id="email" 
          required 
          class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-4 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="your@email.com"
        />
      </div>
      
      <div>
        <label 
          for="message" 
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          Дополнительная информация (необязательно):
        </label>
        <textarea 
          name="message" 
          id="message" 
          rows="3"
          class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-4 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="Любые дополнительные пожелания..."
        ></textarea>
      </div>
      
      <button 
        type="submit" 
        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-3 rounded-md transition-colors"
      >
        Запросить перевод
      </button>
    </form>
  </div>
  
  <div class="text-sm text-gray-500 dark:text-gray-400">
    <p>
      Пока вы можете просмотреть этот контент на других доступных языках или вернуться на главную страницу.
    </p>
  </div>
</article>

<script>
  // Обработка отправки формы
  const form = document.getElementById('translation-request-form');
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      const submitButton = form.querySelector('button[type="submit"]');
      const originalText = submitButton?.textContent;
      
      if (submitButton) {
        submitButton.disabled = true;
        submitButton.textContent = 'Отправка...';
      }
      
      try {
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          body: formData,
        });
        
        const data = await response.json();
        
        if (data.success) {
          if (submitButton) {
            submitButton.textContent = '✓ Запрос отправлен!';
            submitButton.classList.add('bg-green-600', 'hover:bg-green-700');
            form.reset();
          }
        } else {
          throw new Error(data.message || 'Ошибка отправки');
        }
      } catch (error) {
        console.error('Error submitting form:', error);
        if (submitButton) {
          submitButton.textContent = originalText || 'Ошибка. Попробуйте снова';
          submitButton.disabled = false;
        }
        alert('Произошла ошибка при отправке запроса. Пожалуйста, попробуйте позже.');
      }
    });
  }
</script>
