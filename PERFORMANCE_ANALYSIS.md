# Performance Analysis Report
## Optimization of Graph Data Payload

**Date:** 2024-05-22
**Author:** Senior Astro Performance Engineer (Jules)

### 1. Executive Summary

This report details the performance optimization targeting the "Git-Based Knowledge Graph" platform. The primary focus was minimizing the size of the static JSON data files (`graph-data-{lang}.json`) loaded by the client-side graph visualization. By implementing aggressive structural minification—renaming keys to single letters and mapping enums to integers—we achieved a **~30% reduction** in payload size compared to the baseline. This optimization scales with the number of nodes and edges, ensuring better performance as the knowledge base grows to the target 2000+ nodes.

### 2. Bottleneck Analysis

**Identified Issue:**
The application generates a static JSON file for each language containing all nodes and edges for the visualization. Even after initial cleanup, the JSON structure used verbose keys:
-   `nodes`, `edges`
-   `id`, `title`, `type`, `tags`
-   `from`, `to`, `source`
-   Repeated string values for `type` (e.g., "blog", "cases").

**Impact:**
For a large graph (2000+ nodes, 5000+ edges), these keys are repeated thousands of times, wasting bandwidth.

### 3. Optimization Strategy

**Objective:** Minimize JSON payload size using architectural minification.

**Implementation Details:**

1.  **Schema Minification (`src/types/graph.ts`):**
    -   Defined `MinifiedGraphNode` and `MinifiedGraphEdge` interfaces.
    -   Mapped keys:
        -   `nodes` -> `n`
        -   `edges` -> `e`
        -   `id` -> `i`
        -   `title` -> `t`
        -   `type` -> `c` (category index)
        -   `tags` -> `g` (groups)
        -   `from` -> `f`
        -   `to` -> `t`
        -   `source` -> `s`
    -   Mapped values:
        -   `type`: Mapped strings ("blog", "cases", etc.) to integer indices (0, 1, 2, 3).
        -   `source`: Mapped strings ("e", "o") to integers (0, 1).

2.  **Build Pipeline Update (`src/integrations/graph-integration.ts`):**
    -   Implemented the transformation logic to convert domain objects to minified objects before saving.

3.  **Client-Side Inflation (`src/pages/[lang]/graph.astro`):**
    -   Implemented an "inflation" step in the client-side `init()` function.
    -   Fetches the minified JSON and immediately maps it back to the full `GraphNode`/`GraphEdge` structure.
    -   This preserves the maintainability of the UI code (which still uses readable property names) while gaining the network benefits of minification.

### 4. Verification & Results

**Quantitative Metrics:**

| Metric | Baseline (en) | Initial Opt | Minified (en) | Total Reduction |
| :--- | :--- | :--- | :--- | :--- |
| **File Size** | ~8.0 KB | ~6.8 KB | **~5.6 KB** | **~30%** |

**Qualitative Verification:**
-   **Visual Integrity:** Confirmed via Playwright screenshot that the graph renders correctly.
-   **Functionality:** Filtering and navigation logic remains functional.

### 5. Next Steps

To further reach the goal of Mobile Lighthouse 90+ and < 50kb JS bundle:
1.  **Code Splitting:** Verify `force-graph` dynamic import implementation.
2.  **Interaction Optimization:** Investigate moving heavy graph physics calculations to a Web Worker.
3.  **Asset Optimization:** Ensure images referenced in nodes (if any) are properly optimized.

---
*Generated by Jules*
